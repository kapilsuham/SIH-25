<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRA Atlas & Decision Support System</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c5530;
            --secondary: #4a7c59;
            --accent: #8fb996;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--dark);
            background-color: #f5f7f9;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background: var(--gradient);
            color: white;
            padding: 20px 0;
            transition: var(--transition);
            box-shadow: var(--shadow);
            z-index: 1000;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
        }

        .sidebar-header h2 i {
            color: var(--accent);
        }

        .nav-menu {
            list-style: none;
            margin-top: 20px;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--accent);
        }

        .nav-link i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: var(--light);
            border-radius: 50px;
            padding: 8px 20px;
            width: 300px;
        }

        .search-bar input {
            border: none;
            background: transparent;
            padding: 8px;
            width: 100%;
            outline: none;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Quick Location Selector */
        .quick-locations {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .quick-locations h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .location-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .location-btn {
            padding: 8px 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .location-btn:hover {
            background: var(--primary);
        }

        /* Coordinate Input Form */
        .coordinate-form {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .form-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .form-input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(44, 85, 48, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* Current Location Display */
        .current-location {
            background: #e8f5e8;
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .current-location h4 {
            color: var(--primary);
            margin-bottom: 5px;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        /* Stats Cards */
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: rgba(44, 85, 48, 0.1);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-content {
            margin-top: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-title {
            color: #6c757d;
            font-weight: 500;
        }

        /* Map Section */
        .map-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .map-container {
            height: 500px;
            border-radius: 12px;
            overflow: hidden;
        }

        /* Charts Section */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        /* Analysis Results */
        .analysis-results {
            display: none;
        }

        .results-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .recommendations-list {
            list-style: none;
        }

        .recommendation-item {
            padding: 16px;
            border-left: 4px solid var(--primary);
            background-color: #f8f9fa;
            margin-bottom: 12px;
            border-radius: 4px;
        }

        .recommendation-item h4 {
            margin-bottom: 8px;
            color: var(--primary);
        }

        /* Activity Feed */
        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            padding: 16px 0;
            border-bottom: 1px solid #eee;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .activity-icon.approved {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        .activity-icon.pending {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }

        .activity-icon.new {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .activity-time {
            font-size: 0.85rem;
            color: #6c757d;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            gap: 8px;
        }

        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-loading {
            position: relative;
            color: transparent;
        }

        .btn-loading::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin: -10px 0 0 -10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
            }
            .sidebar .nav-text {
                display: none;
            }
            .main-content {
                margin-left: 80px;
            }
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .header {
                flex-direction: column;
                gap: 15px;
            }
            .search-bar {
                width: 100%;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate {
            animation: fadeIn 0.6s ease forwards;
        }

        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }

        /* Leaflet Map Customization */
        .leaflet-container {
            border-radius: 12px;
        }

        .custom-marker {
            background: var(--gradient);
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: var(--shadow);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        /* Notification badge */
        .badge {
            display: inline-block;
            padding: 0.25em 0.6em;
            font-size: 75%;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 50rem;
            background-color: var(--accent);
            color: white;
            margin-left: auto;
        }

        /* Analysis Display Styles */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .analysis-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .analysis-item h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #6c757d;
        }
        
        .analysis-item .score {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }
        
        .score.very_high { color: #28a745; }
        .score.high { color: #17a2b8; }
        .score.medium { color: #ffc107; }
        .score.low { color: #dc3545; }
        
        .score-bars {
            margin-bottom: 20px;
        }
        
        .score-bar {
            margin-bottom: 10px;
        }
        
        .score-bar label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .bar-container {
            display: flex;
            align-items: center;
        }
        
        .bar-container .bar {
            height: 20px;
            background: var(--primary);
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .bar-container span {
            font-weight: 600;
        }
        
        .land-use-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .land-use-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .land-use-item .label {
            font-weight: 500;
        }
        
        .land-use-item .value {
            font-weight: 600;
            color: var(--primary);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-tree"></i> <span class="nav-text">FRA Atlas</span></h2>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active">
                        <i class="fas fa-home"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <i class="fas fa-map-marked-alt"></i>
                        <span class="nav-text">FRA Claims</span>
                        <span class="badge">24</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="analytics.html" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-text">Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="scheme-recommendations.html" class="nav-link">
                        <i class="fas fa-hands-helping"></i>
                        <span class="nav-text">Scheme Recommendations</span>
                        <span class="badge">12</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="data-management.html" class="nav-link">
                        <i class="fas fa-database"></i>
                        <span class="nav-text">Data Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <i class="fas fa-cog"></i>
                        <span class="nav-text">Settings</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Search claims, communities...">
                </div>
                <div class="user-profile">
                    <div>
                        <div class="user-name">Abhay Goyal</div>
                        <div class="user-role">Administrator</div>
                    </div>
                    <div class="user-avatar">AG</div>
                </div>
            </header>

            <!-- Quick Location Selector -->
            <div class="quick-locations">
                <h3>Quick Location Selection - Test Locations Across India</h3>
                <div class="location-buttons">
                    <button class="location-btn" data-lat="23.3441" data-lng="85.3096" data-name="Ranchi, Jharkhand">Ranchi, Jharkhand</button>
                    <button class="location-btn" data-lat="21.2787" data-lng="81.866" data-name="Raipur, Chhattisgarh">Raipur, Chhattisgarh</button>
                    <button class="location-btn" data-lat="20.2961" data-lng="85.8245" data-name="Bhubaneswar, Odisha">Bhubaneswar, Odisha</button>
                    <button class="location-btn" data-lat="23.2599" data-lng="77.4126" data-name="Bhopal, Madhya Pradesh">Bhopal, Madhya Pradesh</button>
                    <button class="location-btn" data-lat="23.8315" data-lng="91.2868" data-name="Agartala, Tripura">Agartala, Tripura</button>
                    <button class="location-btn" data-lat="25.3176" data-lng="82.9739" data-name="Varanasi, Uttar Pradesh">Varanasi, Uttar Pradesh</button>
                    <button class="location-btn" data-lat="26.2389" data-lng="92.9375" data-name="Guwahati, Assam">Guwahati, Assam</button>
                    <button class="location-btn" data-lat="15.2993" data-lng="74.124" data-name="Goa">Goa</button>
                </div>
            </div>

            <!-- Current Location Display -->
            <div id="current-location" class="current-location" style="display: none;">
                <h4>Current Analysis Location</h4>
                <p id="location-details">No location selected</p>
            </div>

            <!-- Coordinate Input Form -->
            <div class="coordinate-form">
                <h2 class="form-title">Enter Location Coordinates</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="latitude" class="form-label">Latitude</label>
                        <input type="number" id="latitude" class="form-input" placeholder="e.g., 23.3441" step="any" required>
                    </div>
                    <div class="form-group">
                        <label for="longitude" class="form-label">Longitude</label>
                        <input type="number" id="longitude" class="form-input" placeholder="e.g., 85.3096" step="any" required>
                    </div>
                    <div class="form-group">
                        <label for="radius" class="form-label">Radius (km)</label>
                        <input type="number" id="radius" class="form-input" value="2.0" min="0.5" max="10" step="0.5">
                    </div>
                </div>
                <div class="form-actions">
                    <button id="analyze-btn" class="btn">
                        <i class="fas fa-search"></i> Analyze Location
                    </button>
                    <button id="get-location-btn" class="btn btn-outline">
                        <i class="fas fa-location-arrow"></i> Use My Location
                    </button>
                    <button id="clear-btn" class="btn btn-outline">
                        <i class="fas fa-eraser"></i> Clear
                    </button>
                </div>
                <div id="message-container"></div>
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="loading-spinner" style="display: none;">
                <div class="spinner"></div>
                <p style="margin-top: 20px;">Analyzing location data...</p>
            </div>

            <!-- Analysis Results -->
            <div id="analysis-results" class="analysis-results">
                <!-- Dashboard Stats -->
                <div class="dashboard-grid">
                    <div class="stat-card animate">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-claims">0</div>
                            <div class="stat-title">Total FRA Claims</div>
                        </div>
                    </div>

                    <div class="stat-card animate delay-1">
                        <div class="stat-header">
                            <div class="stat-icon" style="color: var(--success); background: rgba(40, 167, 69, 0.1);">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="approved-claims">0</div>
                            <div class="stat-title">Approved Claims</div>
                        </div>
                    </div>

                    <div class="stat-card animate delay-2">
                        <div class="stat-header">
                            <div class="stat-icon" style="color: var(--warning); background: rgba(255, 193, 7, 0.1);">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="pending-claims">0</div>
                            <div class="stat-title">Pending Claims</div>
                        </div>
                    </div>

                    <div class="stat-card animate delay-3">
                        <div class="stat-header">
                            <div class="stat-icon" style="color: var(--danger); background: rgba(220, 53, 69, 0.1);">
                                <i class="fas fa-times-circle"></i>
                            </div>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="rejected-claims">0</div>
                            <div class="stat-title">Rejected Claims</div>
                        </div>
                    </div>
                </div>

                <!-- Map Section -->
                <div class="map-section animate delay-4">
                    <div class="section-header">
                        <h2 class="section-title">FRA Claims Distribution</h2>
                        <div class="section-actions">
                            <button class="btn btn-outline" id="filter-btn">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                            <button class="btn btn-outline" id="export-map-btn">
                                <i class="fas fa-download"></i> Export Map
                            </button>
                        </div>
                    </div>
                    <div class="map-container" id="map"></div>
                </div>

                <!-- FRA Analysis Results -->
                <div class="results-section">
                    <div class="results-header">
                        <h2 class="results-title">FRA Suitability Analysis</h2>
                    </div>
                    <div id="fra-analysis-content">
                        <!-- FRA analysis content will be inserted here -->
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="results-section">
                    <div class="results-header">
                        <h2 class="results-title">Recommendations</h2>
                    </div>
                    <div id="recommendations-content">
                        <!-- Recommendations will be inserted here -->
                    </div>
                </div>

                <!-- Charts and Activity -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="section-header">
                            <h2 class="section-title">Claims by State</h2>
                        </div>
                        <div class="chart-container">
                            <canvas id="stateChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="section-header">
                            <h2 class="section-title">Recent Activities</h2>
                            <a href="#" class="btn btn-outline" id="view-all-btn">View All</a>
                        </div>
                        <ul class="activity-list" id="activity-list">
                            <li class="activity-item">
                                <div class="activity-icon new">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">New claim submitted by Adivasi Community</div>
                                    <div class="activity-time">2 hours ago</div>
                                </div>
                            </li>
                            <li class="activity-item">
                                <div class="activity-icon approved">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Claim from Gond Tribe was approved</div>
                                    <div class="activity-time">1 day ago</div>
                                </div>
                            </li>
                            <li class="activity-item">
                                <div class="activity-icon pending">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Scheme recommendations generated for Santhal Community</div>
                                    <div class="activity-time">2 days ago</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Global variables
        let currentMap = null;
        let currentCharts = [];
        let currentPage = 'dashboard';
        let currentMarkers = [];
        let currentLocation = null;

        // Predefined test locations across India
        const testLocations = [
            { name: "Ranchi, Jharkhand", lat: 23.3441, lng: 85.3096, tribes: ["Santhal", "Munda", "Oraon"] },
            { name: "Raipur, Chhattisgarh", lat: 21.2787, lng: 81.866, tribes: ["Gond", "Kamar", "Baiga"] },
            { name: "Bhubaneswar, Odisha", lat: 20.2961, lng: 85.8245, tribes: ["Santhal", "Kondh", "Saora"] },
            { name: "Bhopal, Madhya Pradesh", lat: 23.2599, lng: 77.4126, tribes: ["Gond", "Bhil", "Korku"] },
            { name: "Agartala, Tripura", lat: 23.8315, lng: 91.2868, tribes: ["Tripuri", "Reang", "Jamatia"] },
            { name: "Varanasi, Uttar Pradesh", lat: 25.3176, lng: 82.9739, tribes: ["Gond", "Kol", "Bhuiya"] },
            { name: "Guwahati, Assam", lat: 26.2389, lng: 92.9375, tribes: ["Bodo", "Mising", "Karbi"] },
            { name: "Goa", lat: 15.2993, lng: 74.124, tribes: ["Kunbi", "Gauda", "Velip"] }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupEventListeners();
            initMap(20.5937, 78.9629, 5); // Center of India
            simulateInitialData();
            showMessage('Welcome! Select a location to begin FRA analysis.', 'info');
        }

        function setupEventListeners() {
            // Main action buttons
            document.getElementById('analyze-btn').addEventListener('click', analyzeLocation);
            document.getElementById('get-location-btn').addEventListener('click', getCurrentLocation);
            document.getElementById('clear-btn').addEventListener('click', clearForm);
            
            // Quick location buttons
            document.querySelectorAll('.location-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const lat = parseFloat(this.dataset.lat);
                    const lng = parseFloat(this.dataset.lng);
                    const name = this.dataset.name;
                    setLocation(lat, lng, name);
                });
            });
            
            // Other buttons
            document.getElementById('filter-btn').addEventListener('click', toggleFilterOptions);
            document.getElementById('export-map-btn').addEventListener('click', exportMap);
            document.getElementById('view-all-btn').addEventListener('click', viewAllActivities);
            document.getElementById('search-input').addEventListener('keyup', handleSearch);
            
            // Sidebar navigation
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    handleNavigation(this);
                });
            });
            
            // Form input validation
            document.getElementById('latitude').addEventListener('input', validateCoordinates);
            document.getElementById('longitude').addEventListener('input', validateCoordinates);
            document.getElementById('radius').addEventListener('input', validateRadius);
        }

        function setLocation(lat, lng, name) {
            document.getElementById('latitude').value = lat;
            document.getElementById('longitude').value = lng;
            
            currentLocation = { lat, lng, name };
            updateCurrentLocationDisplay();
            showMessage(`Location set to ${name}. Click "Analyze Location" to begin analysis.`, 'success');
            
            // Update map to show the selected location
            if (currentMap) {
                currentMap.setView([lat, lng], 12);
                clearMarkers();
                addLocationMarker(lat, lng, name);
            }
        }

        function updateCurrentLocationDisplay() {
            const locationDiv = document.getElementById('current-location');
            const detailsP = document.getElementById('location-details');
            
            if (currentLocation) {
                locationDiv.style.display = 'block';
                detailsP.textContent = `${currentLocation.name} (${currentLocation.lat.toFixed(4)}, ${currentLocation.lng.toFixed(4)})`;
            } else {
                locationDiv.style.display = 'none';
            }
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                showMessage('Getting your location...', 'info');
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        setLocation(lat, lng, `Your Location`);
                        showMessage('Location retrieved successfully!', 'success');
                    },
                    function(error) {
                        showMessage('Unable to get your location. Please enter coordinates manually.', 'error');
                        console.error('Geolocation error:', error);
                    }
                );
            } else {
                showMessage('Geolocation is not supported by this browser.', 'error');
            }
        }

        function clearForm() {
            document.getElementById('latitude').value = '';
            document.getElementById('longitude').value = '';
            document.getElementById('radius').value = '2.0';
            currentLocation = null;
            updateCurrentLocationDisplay();
            clearMessages();
            
            if (currentMap) {
                clearMarkers();
                currentMap.setView([20.5937, 78.9629], 5);
            }
            
            document.getElementById('analysis-results').style.display = 'none';
        }

        function validateCoordinates() {
            const lat = parseFloat(document.getElementById('latitude').value);
            const lng = parseFloat(document.getElementById('longitude').value);
            
            let valid = true;
            let message = '';
            
            if (isNaN(lat) || lat < -90 || lat > 90) {
                valid = false;
                message = 'Latitude must be between -90 and 90 degrees';
            } else if (isNaN(lng) || lng < -180 || lng > 180) {
                valid = false;
                message = 'Longitude must be between -180 and 180 degrees';
            }
            
            if (!valid && message) {
                showMessage(message, 'error');
            } else if (valid && !isNaN(lat) && !isNaN(lng)) {
                clearMessages();
                currentLocation = { lat, lng, name: `Custom Location (${lat.toFixed(4)}, ${lng.toFixed(4)})` };
                updateCurrentLocationDisplay();
            }
        }

        function validateRadius() {
            const radius = parseFloat(document.getElementById('radius').value);
            
            if (isNaN(radius) || radius < 0.5 || radius > 10) {
                showMessage('Radius must be between 0.5 and 10 km', 'error');
                return false;
            }
            return true;
        }

        async function analyzeLocation() {
            const latitude = parseFloat(document.getElementById('latitude').value);
            const longitude = parseFloat(document.getElementById('longitude').value);
            const radius = parseFloat(document.getElementById('radius').value);
            
            // Validate inputs
            if (isNaN(latitude) || isNaN(longitude) || isNaN(radius)) {
                showMessage('Please enter valid coordinates and radius', 'error');
                return;
            }
            
            if (latitude < -90 || latitude > 90) {
                showMessage('Latitude must be between -90 and 90 degrees', 'error');
                return;
            }
            
            if (longitude < -180 || longitude > 180) {
                showMessage('Longitude must be between -180 and 180 degrees', 'error');
                return;
            }
            
            if (radius < 0.5 || radius > 10) {
                showMessage('Radius must be between 0.5 and 10 km', 'error');
                return;
            }
            
            // Show loading state
            startAnalysis();
            
            try {
                // Try to call the backend API first
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        latitude: latitude,
                        longitude: longitude,
                        radius_km: radius
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    updateUIWithAnalysisResults(data, latitude, longitude, radius);
                    showMessage('Analysis completed successfully!', 'success');
                } else {
                    throw new Error(`API error: ${response.status}`);
                }
                
            } catch (error) {
                console.log('API not available, using simulated data:', error);
                // Use simulated data when API is not available
                const simulatedData = generateSimulatedData(latitude, longitude, radius);
                updateUIWithAnalysisResults(simulatedData, latitude, longitude, radius);
                showMessage('Analysis completed using simulated data (API not available)', 'info');
            } finally {
                endAnalysis();
            }
        }

        function startAnalysis() {
            document.getElementById('loading-indicator').style.display = 'flex';
            document.getElementById('analysis-results').style.display = 'none';
            
            const analyzeBtn = document.getElementById('analyze-btn');
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
            analyzeBtn.disabled = true;
        }

        function endAnalysis() {
            document.getElementById('loading-indicator').style.display = 'none';
            document.getElementById('analysis-results').style.display = 'block';
            
            const analyzeBtn = document.getElementById('analyze-btn');
            analyzeBtn.innerHTML = '<i class="fas fa-search"></i> Analyze Location';
            analyzeBtn.disabled = false;
        }

        function generateSimulatedData(latitude, longitude, radius) {
            // Find the closest test location to generate realistic data
            const location = findClosestTestLocation(latitude, longitude);
            
            const forestCoverage = Math.floor(Math.random() * 40) + 30;
            const tribalStatus = Math.floor(Math.random() * 40) + 40;
            const livelihoodPotential = Math.floor(Math.random() * 40) + 30;
            const communityPresence = Math.floor(Math.random() * 40) + 40;
            const totalScore = Math.floor((forestCoverage + tribalStatus + livelihoodPotential + communityPresence) / 4);
            
            const suitabilityLevels = ['low', 'medium', 'high', 'very_high'];
            const suitability = totalScore > 75 ? 'very_high' : totalScore > 60 ? 'high' : totalScore > 45 ? 'medium' : 'low';
            
            return {
                geographic_features: {
                    statistics: {
                        total_settlements: Math.floor(Math.random() * 20) + 5,
                        tribal_villages: Math.floor(Math.random() * 15) + 3,
                        forest_area_sq_km: (radius * radius * Math.PI * (forestCoverage / 100)).toFixed(2)
                    }
                },
                fra_analysis: {
                    overall_suitability: suitability,
                    total_score: totalScore,
                    component_scores: {
                        forest_coverage: forestCoverage,
                        tribal_status: tribalStatus,
                        livelihood_potential: livelihoodPotential,
                        community_presence: communityPresence
                    },
                    land_use_breakdown: {
                        forest: forestCoverage,
                        water: Math.floor(Math.random() * 15) + 5,
                        agriculture: Math.floor(Math.random() * 25) + 15,
                        settlement: Math.floor(Math.random() * 10) + 5,
                        other: Math.floor(Math.random() * 15) + 5
                    },
                    region_info: {
                        region_name: location.region,
                        dominant_tribes: location.tribes
                    }
                },
                recommendations: generateRecommendations(suitability, location)
            };
        }

        function findClosestTestLocation(lat, lng) {
            let closest = testLocations[0];
            let minDistance = calculateDistance(lat, lng, closest.lat, closest.lng);
            
            for (let i = 1; i < testLocations.length; i++) {
                const distance = calculateDistance(lat, lng, testLocations[i].lat, testLocations[i].lng);
                if (distance < minDistance) {
                    minDistance = distance;
                    closest = testLocations[i];
                }
            }
            
            return {
                region: closest.name.split(', ')[1] || closest.name,
                tribes: closest.tribes
            };
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLng/2) * Math.sin(dLng/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        function generateRecommendations(suitability, location) {
            const baseRecommendations = {
                immediate_actions: [
                    "Form Village Forest Rights Committee in identified settlements",
                    "Conduct community meetings in all mapped village locations",
                    "Document traditional forest use patterns"
                ],
                infrastructure_development: [
                    "Improve road connectivity to remote tribal areas",
                    "Develop water infrastructure for sustainable livelihoods"
                ],
                conservation_priorities: [
                    "Establish community forest protection measures",
                    "Implement sustainable forest management practices"
                ],
                livelihood_opportunities: [
                    "Promote sustainable forest-based livelihoods",
                    "Support traditional crafts and skill development"
                ]
            };
            
            // Add region-specific recommendations
            if (location.tribes) {
                baseRecommendations.immediate_actions.push(
                    `Engage with ${location.tribes.join(', ')} tribal communities`
                );
                baseRecommendations.livelihood_opportunities.push(
                    `Support traditional practices of ${location.tribes[0]} community`
                );
            }
            
            if (suitability === 'very_high') {
                baseRecommendations.conservation_priorities.unshift(
                    "High priority area - expedite FRA recognition process"
                );
            }
            
            return baseRecommendations;
        }

        function updateUIWithAnalysisResults(data, latitude, longitude, radius) {
            // Update statistics
            const stats = data.geographic_features?.statistics || {};
            document.getElementById('total-claims').textContent = stats.total_settlements || 0;
            document.getElementById('approved-claims').textContent = Math.floor((stats.total_settlements || 0) * 0.7);
            document.getElementById('pending-claims').textContent = Math.floor((stats.total_settlements || 0) * 0.2);
            document.getElementById('rejected-claims').textContent = Math.floor((stats.total_settlements || 0) * 0.1);
            
            // Update the map
            updateMap(data, latitude, longitude, radius);
            
            // Update FRA analysis
            updateFRAnalysis(data.fra_analysis);
            
            // Update recommendations
            updateRecommendations(data.recommendations);
            
            // Update charts
            updateCharts(data);
            
            // Animate counters
            animateCounters();
        }

        function initMap(lat, lng, zoom) {
            if (currentMap) {
                currentMap.remove();
            }
            
            currentMap = L.map('map').setView([lat, lng], zoom);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(currentMap);
        }

        function updateMap(data, lat, lng, radius) {
            if (!currentMap) {
                initMap(lat, lng, 12);
            } else {
                currentMap.setView([lat, lng], 12);
            }
            
            clearMarkers();
            
            // Add center marker
            addLocationMarker(lat, lng, `Analysis Center`);
            
            // Add analysis radius circle
            L.circle([lat, lng], {
                color: '#2c5530',
                fillColor: '#8fb996',
                fillOpacity: 0.2,
                radius: radius * 1000
            }).addTo(currentMap).bindPopup(`Analysis Area (${radius} km radius)`);
            
            // Add sample FRA claim markers
            generateSampleClaims(lat, lng, radius).forEach(claim => {
                addClaimMarker(claim);
            });
        }

        function addLocationMarker(lat, lng, title) {
            const marker = L.marker([lat, lng]).addTo(currentMap)
                .bindPopup(title)
                .openPopup();
            currentMarkers.push(marker);
        }

        function addClaimMarker(claim) {
            const iconColor = getClaimIconColor(claim.status);
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="background: ${iconColor}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; display: flex; align-items: center; justify-content: center;">
                         <i class="fas ${getClaimIcon(claim.status)}" style="color: white; font-size: 10px;"></i>
                       </div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });
            
            const marker = L.marker([claim.lat, claim.lng], { icon }).addTo(currentMap)
                .bindPopup(`<strong>${claim.name}</strong><br>Status: ${claim.status}<br>Community: ${claim.community}`);
            currentMarkers.push(marker);
        }

        function getClaimIconColor(status) {
            switch(status) {
                case 'approved': return '#28a745';
                case 'pending': return '#ffc107';
                case 'rejected': return '#dc3545';
                default: return '#6c757d';
            }
        }

        function getClaimIcon(status) {
            switch(status) {
                case 'approved': return 'fa-check';
                case 'pending': return 'fa-clock';
                case 'rejected': return 'fa-times';
                default: return 'fa-question';
            }
        }

        function generateSampleClaims(centerLat, centerLng, radius) {
            const claims = [];
            const statuses = ['approved', 'pending', 'rejected'];
            const communities = ['Gond', 'Santhal', 'Munda', 'Oraon', 'Bhil', 'Baiga'];
            
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * 2 * Math.PI;
                const distance = Math.random() * (radius - 0.5) + 0.5;
                const deltaLat = (distance / 111) * Math.cos(angle);
                const deltaLng = (distance / (111 * Math.cos(centerLat * Math.PI / 180))) * Math.sin(angle);
                
                claims.push({
                    lat: centerLat + deltaLat,
                    lng: centerLng + deltaLng,
                    name: `Settlement ${i + 1}`,
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    community: communities[Math.floor(Math.random() * communities.length)]
                });
            }
            
            return claims;
        }

        function clearMarkers() {
            currentMarkers.forEach(marker => {
                currentMap.removeLayer(marker);
            });
            currentMarkers = [];
        }

        function updateFRAnalysis(analysis) {
            const analysisContent = document.getElementById('fra-analysis-content');
            
            if (!analysis) {
                analysisContent.innerHTML = '<p>No analysis data available.</p>';
                return;
            }
            
            analysisContent.innerHTML = `
                <div class="analysis-grid">
                    <div class="analysis-item">
                        <h3>Overall Suitability</h3>
                        <p class="score ${analysis.overall_suitability}">${analysis.overall_suitability.replace('_', ' ').toUpperCase()}</p>
                    </div>
                    <div class="analysis-item">
                        <h3>Total Score</h3>
                        <p class="score">${analysis.total_score}/100</p>
                    </div>
                    <div class="analysis-item">
                        <h3>Region</h3>
                        <p>${analysis.region_info?.region_name || 'Unknown'}</p>
                    </div>
                    <div class="analysis-item">
                        <h3>Dominant Tribes</h3>
                        <p>${analysis.region_info?.dominant_tribes?.join(', ') || 'Various'}</p>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">Component Scores</h3>
                <div class="score-bars">
                    ${Object.entries(analysis.component_scores || {}).map(([key, value]) => `
                        <div class="score-bar">
                            <label>${key.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}</label>
                            <div class="bar-container">
                                <div class="bar" style="width: ${value}%;"></div>
                                <span>${value}%</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <h3 style="margin-top: 20px;">Land Use Breakdown</h3>
                <div class="land-use-grid">
                    ${Object.entries(analysis.land_use_breakdown || {}).map(([key, value]) => `
                        <div class="land-use-item">
                            <span class="label">${key.charAt(0).toUpperCase() + key.slice(1)}</span>
                            <span class="value">${value}%</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function updateRecommendations(recommendations) {
            const recommendationsContent = document.getElementById('recommendations-content');
            
            if (!recommendations || Object.keys(recommendations).length === 0) {
                recommendationsContent.innerHTML = '<p>No recommendations available.</p>';
                return;
            }
            
            let html = '';
            Object.entries(recommendations).forEach(([category, items]) => {
                if (items && items.length > 0) {
                    html += `
                        <h3>${category.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}</h3>
                        <ul class="recommendations-list">
                            ${items.map(item => `<li class="recommendation-item">${item}</li>`).join('')}
                        </ul>
                    `;
                }
            });
            
            recommendationsContent.innerHTML = html;
        }

        function updateCharts(data) {
            currentCharts.forEach(chart => chart.destroy());
            currentCharts = [];
            
            const ctx = document.getElementById('stateChart');
            if (ctx) {
                const chart = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Approved', 'Pending', 'Rejected', 'Under Review'],
                        datasets: [{
                            data: [45, 25, 15, 15],
                            backgroundColor: ['#28a745', '#ffc107', '#dc3545', '#6c757d'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
                currentCharts.push(chart);
            }
        }

        function animateCounters() {
            const counters = document.querySelectorAll('.stat-value');
            counters.forEach(counter => {
                const target = +counter.innerText;
                let current = 0;
                const increment = Math.ceil(target / 50);
                
                const updateCounter = () => {
                    current += increment;
                    if (current < target) {
                        counter.innerText = current;
                        setTimeout(updateCounter, 30);
                    } else {
                        counter.innerText = target;
                    }
                };
                updateCounter();
            });
        }

        function showMessage(message, type = 'info') {
            const container = document.getElementById('message-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `${type}-message`;
            messageDiv.textContent = message;
            
            container.innerHTML = '';
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 5000);
        }

        function clearMessages() {
            document.getElementById('message-container').innerHTML = '';
        }

        // Event handlers for other functionality
        function handleNavigation(clickedElement) {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            clickedElement.classList.add('active');
            
            const pageName = clickedElement.querySelector('.nav-text').textContent.toLowerCase();
            currentPage = pageName;
            
            if (pageName !== 'dashboard') {
                showMessage(`${pageName} functionality would be implemented here.`, 'info');
            }
        }

        function toggleFilterOptions() {
            showMessage('Filter options would be displayed here. Available filters: Status, Community Type, Date Range', 'info');
        }

        function exportMap() {
            showMessage('Map export functionality would be implemented here. Formats: PNG, PDF, KML', 'info');
        }

        function viewAllActivities() {
            showMessage('Full activity log would be displayed here.', 'info');
        }

        function handleSearch(e) {
            if (e.key === 'Enter') {
                const searchTerm = e.target.value;
                if (searchTerm.trim() !== '') {
                    showMessage(`Search functionality would be implemented here. Searching for: "${searchTerm}"`, 'info');
                }
            }
        }

        function simulateInitialData() {
            document.getElementById('total-claims').textContent = '0';
            document.getElementById('approved-claims').textContent = '0';
            document.getElementById('pending-claims').textContent = '0';
            document.getElementById('rejected-claims').textContent = '0';
        }
    </script>
</body>
</html>